providers = ["python"]

[variables]
PYTHONUNBUFFERED = "1"

[phases.setup]
# Only runtime dependencies - no build tools to reduce size
nixPkgs = ["python39", "libGL", "glib", "glibc", "libGLU", "pkg-config", "ffmpeg"]

[phases.install]
cmds = [
  "python -m venv --copies /opt/venv",
  ". /opt/venv/bin/activate && pip install --no-cache-dir --upgrade pip",
  ". /opt/venv/bin/activate && pip install --no-cache-dir -r requirements.txt",
  # Clean up pip cache and unnecessary files
  "rm -rf /opt/venv/lib/python3.9/site-packages/*/tests",
  "rm -rf /opt/venv/lib/python3.9/site-packages/*/test",
  "find /opt/venv -type d -name '__pycache__' -exec rm -r {} + 2>/dev/null || true",
  "find /opt/venv -type f -name '*.pyc' -delete",
  "find /opt/venv -type f -name '*.pyo' -delete"
]
